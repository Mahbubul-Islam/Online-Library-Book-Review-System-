{% extends 'base.html' %} 
{% block title %}
{{ book.title }} - Online Library{% endblock %} {% block content %}
<div class="container mx-auto px-4 py-8">
	<!-- Back Button -->
	<div class="mb-6">
		<a
			href="{% url 'home' %}"
			class="text-blue-600 hover:text-blue-800 transition">
			<i class="fas fa-arrow-left"></i> Back to Library
		</a>
	</div>

	<!-- Book Details -->
	<div class="bg-white rounded-lg shadow-lg p-6 md:p-8 mb-8">
		<!-- Title and Cover Photo Section -->
		<div class="flex flex-col md:flex-row gap-6 mb-6">
			<!-- Left Side: Book Info -->
			<div class="flex-1">
				<!-- Book Title -->
				<h1 class="text-2xl md:text-3xl font-bold text-gray-800 mb-4">
					{{ book.title }}
				</h1>

				<!-- Book Information -->
				<div class="space-y-3 mb-6">
					<p class="text-lg text-gray-700">
						<i class="fas fa-user text-blue-600 w-6"></i>
						<span class="font-semibold">Author:</span> {{ book.author }}
					</p>
					<p class="text-lg text-gray-700">
						<i class="fas fa-tag text-blue-600 w-6"></i>
						<span class="font-semibold">Category:</span> {{ book.category.name }}
					</p>
					<p class="text-lg text-gray-700">
						<i class="fas fa-calendar text-blue-600 w-6"></i>
						<span class="font-semibold">Added:</span> {{ book.created_at|date:"F d, Y" }}
					</p>
				</div>

				<!-- Average Rating -->
				<div class="mb-6">
					<div class="flex items-center">
						<span class="text-lg font-semibold text-gray-700 mr-3"
							>Rating:</span
						>
						<div class="flex text-yellow-400 text-xl">
							{% with rating=average_rating %} 
                            {% for i in "12345" %} 
                            {% if forloop.counter <= rating %}
							<i class="fas fa-star"></i>
							{% else %} {% if forloop.counter|add:"-0.5" <= rating %}
							<i class="fas fa-star-half-alt"></i>
							{% else %}
							<i class="far fa-star"></i>
							{% endif %} {% endif %} {% endfor %} {% endwith %}
						</div>
						<span class="ml-3 text-lg text-gray-600">
							{{ average_rating }} / 5.0
						</span>
						<span class="ml-3 text-sm text-gray-500">
							({{ reviews.count }} review{{ reviews.count|pluralize }})
						</span>
					</div>
				</div>

				<!-- Description -->
				<div>
					<h2 class="text-2xl font-semibold text-gray-800 mb-3">Description</h2>
					<p class="text-gray-700 leading-relaxed whitespace-pre-line">
						{{ book.description }}
					</p>
				</div>
			</div>

			<!-- Right Side: Book Cover -->
			<div class="w-full md:w-64 lg:w-72 flex-shrink-0">
				{% if book.cover_image %}
				<div class="border-2 border-gray-300 rounded-lg overflow-hidden shadow-md">
					<img
						src="{{ book.cover_image.url }}"
						alt="{{ book.title }}"
						class="w-full h-auto object-cover" />
				</div>
				{% else %}
				<div class="border-2 border-gray-300 rounded-lg overflow-hidden shadow-md h-80 bg-gradient-to-br from-blue-400 to-blue-600 flex items-center justify-center">
					<i class="fas fa-book text-white text-7xl"></i>
				</div>
				{% endif %}
			</div>
		</div>
	</div>

	<!-- Reviews Section -->
	<div class="bg-white rounded-lg shadow-lg p-6 md:p-8">
		<h2 class="text-2xl font-bold text-gray-800 mb-6">
			<i class="fas fa-comments text-blue-600"></i> Reviews
		</h2>

		<!-- Add Review Form (Only for authenticated users) -->
		{% if user.is_authenticated %}
		<div class="bg-blue-50 rounded-lg p-6 mb-8">
			<h3 class="text-xl font-semibold text-gray-800 mb-4">
				Write Your Review
			</h3>
			<form method="POST" action="">
				{% csrf_token %}

				<!-- Rating -->
				<div class="mb-4">
					<label
						for="{{ form.rating.id_for_label }}"
						class="block text-sm font-medium text-gray-700 mb-2">
						{{ form.rating.label }}
					</label>
					<select
						name="{{ form.rating.name }}"
						id="{{ form.rating.id_for_label }}"
						class="w-full md:w-48 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
						<option value="">Select rating</option>
						<option value="1">⭐ 1 - Poor</option>
						<option value="2">⭐⭐ 2 - Fair</option>
						<option value="3">⭐⭐⭐ 3 - Good</option>
						<option value="4">⭐⭐⭐⭐ 4 - Very Good</option>
						<option value="5">⭐⭐⭐⭐⭐ 5 - Excellent</option>
					</select>
				</div>

				<!-- Comment -->
				<div class="mb-4">
					<label
						for="{{ form.comment.id_for_label }}"
						class="block text-sm font-medium text-gray-700 mb-2">
						Your Review
					</label>
					{{ form.comment }}
				</div>

				<!-- Submit Button -->
				<button
					type="submit"
					class="bg-blue-600 hover:bg-blue-700 text-white font-semibold px-6 py-2 rounded-lg transition duration-200">
					<i class="fas fa-paper-plane"></i> Submit Review
				</button>
			</form>
		</div>
		{% else %}
		<div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-8">
			<div class="flex">
				<i class="fas fa-info-circle text-yellow-400 text-xl mr-3"></i>
				<div>
					<p class="text-yellow-700">
						Please
						<a
							href="{% url 'login' %}"
							class="font-semibold underline hover:text-yellow-900"
							>login</a
						>
						or
						<a
							href="{% url 'register' %}"
							class="font-semibold underline hover:text-yellow-900"
							>register</a
						>
						to write a review.
					</p>
				</div>
			</div>
		</div>
		{% endif %}

		<!-- Existing Reviews -->
		{% if reviews %}
		<div class="space-y-6">
			{% for review in reviews %}
			<div class="border-b border-gray-200 pb-6 last:border-b-0">
				<div class="flex items-start justify-between mb-3">
					<div>
						<p class="font-semibold text-gray-800">
							<i class="fas fa-user-circle text-blue-600"></i> {{ review.user.username }}
						</p>
						<p class="text-sm text-gray-500">
							{{ review.created_at|date:"F d, Y - g:i A" }}
						</p>
					</div>
					{% if review.rating %}
					<div class="flex text-yellow-400">
						{% for i in "12345" %} {% if forloop.counter <= review.rating %}
						<i class="fas fa-star"></i>
						{% else %}
						<i class="far fa-star"></i>
						{% endif %} {% endfor %}
					</div>
					{% endif %}
				</div>
				<p class="text-gray-700 leading-relaxed">{{ review.comment }}</p>
			</div>
			{% endfor %}
		</div>
		{% else %}
		<div class="text-center py-8">
			<i class="fas fa-comment-slash text-gray-300 text-5xl mb-4"></i>
			<p class="text-gray-500">
				No reviews yet. Be the first to review this book!
			</p>
		</div>
		{% endif %}
	</div>
</div>
{% endblock %}
